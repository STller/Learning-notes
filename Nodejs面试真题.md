# Nodejs是什么

1. nodejs是基于Chrome V8引擎的Javascript运行时
2. nodejs出现之前，js只能在浏览器中运行
3. nodejs出现之后，js可以运行在任何安装ndoejs的环境中

# nodejs和前端js的区别

1. 都使用ES语法
2. 前端使用JS WEB API
3. nodejs使用node API
4. 前端js用于网页，在浏览器运行
5. nodejs可用于服务端，如开发web server
6. nodejs也可用于本机，如webpack等本机的工具

# nodejs如何调试

基于VScode调试

# 当前文件和当前目录的路径，如何获取

1. __dirname回传被执行js文件所在文件夹的绝对路径
2. __filename回传被执行js文件的绝对路径
3. process.cwd():回传执行node指令时所在文件夹的绝对路径
4. ./:和process.cwd()一样

# commonjs和ES6 Module的区别

1. 语法不同
2. commonjs是动态引入，执行时引入
3. ES6 Module是静态引入，编译时引入

eg：webpack编译时，做tree-shaking需要明确知道那些需要那些不需要，如果是编译时引入就可以支持这种优化。

# path.resolve和path.join的区别

1. 都用于拼接路径
2. join返回相对路径
3. resolve返回绝对路径

# 浏览器 event loop

1. Call Stack空闲时，将触发Event Loop机制，执行宏任务
2. 而触发Event Loop之前，会把现有的微任务都执行完
3. 所以微任务比宏任务执行时机更早

# Javascript运行机制

1. JS是单线程的

JavaScript是单线程的，假定JavaScript同时拥有两个线程，一个线程在某个DOM节点上添加内容，另一个线程删除了这个节点，呐么应该以哪个操作为准？所以为了避免复杂性，从诞生起，就是单线程。

为了利用多核CPU的计算能力，H5提出Web Worker标准，允许JS脚本创建多个线程，但是子线程完全受控于主线程，且不得操作DOM，所以这个新标准并没有改变JS单线程的本质。

2. 任务队列

所有任务分为两种，同步任务、异步任务。同步任务指的是在主线程上排队执行的任务，只有前一个任务执行完毕，才能执行后一个任务；异步任务指的是，不进入主线程、而进入`任务队列`的任务，只有`任务队列`通知主线程，某个异步任务可以执行了，该任务才会进入主线程执行。

3. 异步执行机制

所有同步任务在主线程上执行，形成一个执行栈

主线程之外，还存在一个`任务队列`。只要异步任务有了运行结果，就在`任务队列`之中放置一个事件

一旦`执行栈`中的所有同步任务执行完毕，系统就会读取`任务队列`，看看有哪些事件。那些对应的异步任务，于是结束等待状态，进入执行栈，开始执行

主线程不断重复上面的第三步

只要主线程空了，就会去读取`任务队列`，这个过程不断重复

4. 事件和回调函数

`任务队列`是一个事件的队列，IO设备完成一项任务，就在`任务队列`中添加一个事件，表示相关的异步任务可以进入`执行栈`了。主线程读取任务队列，就是读取里面有哪些事件

`任务队列`中的事件，除了IO设备的事件以外，还包括一些用户产生的事件（鼠标点击、页面滚动等）。只要指定过回调函数，这些事件发生时就会进入`任务队列`，等待主线程执行

所谓`回调函数`，就是那些会被主线程挂起来的代码。异步任务必须指定回调函数，当主线程开始执行异步任务，就是执行对应的回调函数

任务队列是一个先进先出的数据结构，排在前面的事件，优先被主线程读取。主线程的读取过程基本上是自动的，只要执行栈一清空，任务队列上第一位的事件就自动进入主线程。但是，由于存在后文存在的`定时器`功能，主线程首先要检查一下执行时间，某些事件只有到了规定的时间，才能返回主线程

5. Event Loop

主线程从`任务队列`中读取事件，这个过程是不断循环的，所以整个的这种运行机制又称为Event Loop（事件循环）

6. 定时器

setTimeOut（fn，0）的含义是，指定某个任务在主线程今早可得的空闲时间执行。它在任务队列的尾部添加一个事件，因此会等到同步任务和`任务队列`现有的事件都处理完，才会得到执行

H5标准规定了setTimeOut的第二个参数的最小值，不得低于4毫秒。在此之前的老版本浏览器将最短时间间隔设为10毫秒。另外，对于那些DOM的变动（尤其是涉及到页面重新渲染的部分）， 通常不会立即执行，而是每16毫秒执行一次。这时使用requestAnimationFrame的效果要好于setTimeOut

7. Nodejs的Evnet Loop

V8引擎解析JS脚本

解析后的代码，调用Node API

libuv库负责Node API的执行。它将不同的任务分配给不同的线程，形成一个Evnet Loop，以异步的方式将任务的执行结果返回给V8引擎

V8引擎再将结果返回给用户

除了setTimeOut和setInterval两个方法，Nodejs还提供了另外两个与`任务队列`有关的方法：process.nextTick&&setImmediate。前者可在当前执行栈的尾部，下次读取`任务队列`之前触发，它指定的任务总是发生在所有的异步任务之前。后者则是在当前`任务队列`的尾部添加事件。

如果有多个process.nextTick语句（不管他们是否嵌套），将全部在当前`执行栈`执行

